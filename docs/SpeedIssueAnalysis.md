# é€Ÿåº¦ç›¸å…³é—®é¢˜æ’æŸ¥æŠ¥å‘Š

## ğŸ” é—®é¢˜åˆ†æ

ç”¨æˆ·åé¦ˆï¼š"ç‹‚æš´æŠ€èƒ½ä¹Ÿä¸å¯¹ï¼Œä¸€æŒ‰å°±é€Ÿåº¦é£å¿«ï¼Œè€Œä¸”ä¸æ¢å¤"

è®©æˆ‘ä»¬æ˜ç¡®ä¸¤ç§"é€Ÿåº¦"ï¼š
1. **ç§»åŠ¨é€Ÿåº¦** (`speed`) - è§’è‰²åœ¨åœ°å›¾ä¸Šç§»åŠ¨çš„é€Ÿåº¦
2. **æ”»å‡»é€Ÿåº¦** (`attack_speed`) - æ­¦å™¨æ”»å‡»çš„é¢‘ç‡ï¼ˆé—´éš”æ—¶é—´ï¼‰

---

## ğŸ“Š å½“å‰æ˜ å°„éªŒè¯

### ç‹‚æš´æŠ€èƒ½çš„æ˜ å°„

**é…ç½®** (`class_database.gd`):
```gdscript
"ç‹‚æš´",  # skill_name
{
    "cooldown": 10.0,
    "duration": 5.0,
    "attack_speed_boost": 0.5,  # æ”»å‡»é€Ÿåº¦+50%
    "damage_boost": 1.3  # ä¼¤å®³+30%
}
```

**å½“å‰æ˜ å°„** (`class_manager.gd`):
```gdscript
var attack_speed_boost = params.get("attack_speed_boost", 0.0)  // 0.5
var damage_boost = params.get("damage_boost", 1.0)  // 1.3
modifier.stats_delta.global_attack_speed_mult = 1.0 + attack_speed_boost  // 1.5
modifier.stats_delta.global_damage_mult = damage_boost  // 1.3
```

**æ˜ å°„åˆ°çš„å±æ€§**ï¼š
- âœ… `global_attack_speed_mult = 1.5` - **æ­¦å™¨æ”»å‡»é€Ÿåº¦Ã—1.5**
- âœ… `global_damage_mult = 1.3` - ä¼¤å®³Ã—1.3
- âŒ ä¸å½±å“ç§»åŠ¨é€Ÿåº¦ `speed`

### æ”»å‡»é€Ÿåº¦çš„è®¡ç®—

åœ¨ `DamageCalculator.calculate_attack_speed()`:
```gdscript
var global_mult = (1.0 + attacker_stats.global_attack_speed_add) * attacker_stats.global_attack_speed_mult
speed /= global_mult  // é™¤ä»¥å€æ•°

// ä¾‹å­ï¼š
// base_attack_speed = 0.5ç§’
// global_mult = 1.5
// final_speed = 0.5 / 1.5 = 0.33ç§’ï¼ˆæ”»å‡»é—´éš”æ›´çŸ­ï¼Œæ”»å‡»æ›´å¿«ï¼‰
```

**è¿™æ˜¯æ­£ç¡®çš„ï¼** æ”»å‡»é—´éš”å˜çŸ­ = æ”»å‡»é¢‘ç‡å˜é«˜ = æ­¦å™¨æ”»å‡»æ›´å¿« âœ…

---

## ğŸ¤” å¯èƒ½çš„é—®é¢˜

### é—®é¢˜1ï¼šç”¨æˆ·è¯¯è§£äº†"é€Ÿåº¦"çš„å«ä¹‰

**å¯èƒ½æƒ…å†µ**ï¼š
- ç”¨æˆ·çœ‹åˆ°æ­¦å™¨æ”»å‡»å˜å¿«ï¼Œä»¥ä¸ºæ˜¯ç§»åŠ¨é€Ÿåº¦å˜å¿«
- å®é™…ä¸Šï¼šç‹‚æš´æŠ€èƒ½**åº”è¯¥**è®©æ­¦å™¨æ”»å‡»å˜å¿«ï¼Œè¿™æ˜¯æ­£ç¡®çš„è¡Œä¸º

**éªŒè¯æ–¹æ³•**ï¼š
- è§‚å¯Ÿè§’è‰²ç§»åŠ¨é€Ÿåº¦æ˜¯å¦å˜åŒ–
- è§‚å¯Ÿæ­¦å™¨æ”»å‡»é¢‘ç‡æ˜¯å¦å˜åŒ–

### é—®é¢˜2ï¼šæ”»å‡»é€Ÿåº¦å€æ•°è®¡ç®—é”™è¯¯

**å½“å‰è®¡ç®—**ï¼š
```
base = 0.5ç§’
mult = 1.5
result = 0.5 / 1.5 = 0.33ç§’
```

**æ˜¯å¦æ­£ç¡®ï¼Ÿ**
- 0.5ç§’ â†’ æ¯ç§’2æ¬¡æ”»å‡»
- 0.33ç§’ â†’ æ¯ç§’3æ¬¡æ”»å‡»
- æå‡ï¼š50%ï¼ˆä»2æ¬¡åˆ°3æ¬¡ï¼‰âœ… æ­£ç¡®ï¼

### é—®é¢˜3ï¼šæŠ€èƒ½æ•ˆæœä¸æ¢å¤

**å·²ä¿®å¤**ï¼šåœ¨ Round 1 ä¸­å·²ç»æ·»åŠ äº†ç§»é™¤æ—§ä¿®æ”¹å™¨çš„é€»è¾‘
```gdscript
if skill_modifiers.has(skill_name):
    var old_modifier = skill_modifiers[skill_name]
    player.attribute_manager.remove_modifier_by_id(old_modifier.modifier_id)
```

**éªŒè¯æ–¹æ³•**ï¼š
- æ¿€æ´»æŠ€èƒ½åç­‰å¾…5ç§’
- æ£€æŸ¥ `attribute_manager.temporary_modifiers` æ˜¯å¦æ¸…ç©º
- æ£€æŸ¥æ­¦å™¨æ”»å‡»é€Ÿåº¦æ˜¯å¦æ¢å¤æ­£å¸¸

---

## ğŸ”¬ è°ƒè¯•å»ºè®®

### 1. æ·»åŠ è°ƒè¯•è¾“å‡º

åœ¨ `class_manager.gd` çš„ `activate_skill()` ä¸­ï¼š
```gdscript
print("[ClassManager] æŠ€èƒ½æ¿€æ´»å‰ - ä¸´æ—¶ä¿®æ”¹å™¨æ•°é‡: ", player.attribute_manager.temporary_modifiers.size())
player.attribute_manager.add_temporary_modifier(skill_modifier)
print("[ClassManager] æŠ€èƒ½æ¿€æ´»å - ä¸´æ—¶ä¿®æ”¹å™¨æ•°é‡: ", player.attribute_manager.temporary_modifiers.size())
print("[ClassManager] ä¿®æ”¹å™¨å†…å®¹: global_attack_speed_mult=", skill_modifier.stats_delta.global_attack_speed_mult)
```

### 2. ç›‘æ§ AttributeManager

åœ¨ `AttributeManager._process()` ä¸­ï¼š
```gdscript
# åœ¨ç§»é™¤è¿‡æœŸä¿®æ”¹å™¨æ—¶
print("[AttributeManager] ç§»é™¤è¿‡æœŸä¿®æ”¹å™¨: ", expired_modifier.modifier_id, " å‰©ä½™: ", temporary_modifiers.size())
```

### 3. æ£€æŸ¥æœ€ç»ˆå±æ€§

åœ¨ `Player._process()` ä¸­ï¼š
```gdscript
# å®šæœŸè¾“å‡º
if int(Time.get_ticks_msec()) % 1000 == 0:  # æ¯ç§’è¾“å‡ºä¸€æ¬¡
    if attribute_manager and attribute_manager.final_stats:
        print("å½“å‰é€Ÿåº¦: ", attribute_manager.final_stats.speed)
        print("å½“å‰æ”»å‡»é€Ÿåº¦å€æ•°: ", attribute_manager.final_stats.global_attack_speed_mult)
```

---

## âœ… ç»“è®º

æ ¹æ®ä»£ç åˆ†æï¼Œå½“å‰çš„å®ç°æ˜¯**æ­£ç¡®çš„**ï¼š

1. **ç‹‚æš´æŠ€èƒ½**åº”è¯¥å½±å“æ­¦å™¨æ”»å‡»é€Ÿåº¦ï¼Œä¸å½±å“ç§»åŠ¨é€Ÿåº¦ âœ…
2. **æ”»å‡»é€Ÿåº¦Ã—1.5**çš„è®¡ç®—æ˜¯æ­£ç¡®çš„ï¼ˆæ”»å‡»é—´éš”ç¼©çŸ­50%ï¼‰âœ…
3. **æŠ€èƒ½ç»“æŸåè‡ªåŠ¨æ¢å¤**çš„æœºåˆ¶å·²ç»å®ç° âœ…

### å¦‚æœç”¨æˆ·ä»ç„¶é‡åˆ°é—®é¢˜ï¼Œå¯èƒ½æ˜¯ï¼š

1. **ç§»åŠ¨é€Ÿåº¦**è¢«é”™è¯¯åœ°ä¿®æ”¹äº†
   - éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–åœ°æ–¹ä¿®æ”¹äº† `speed` å±æ€§
   
2. **æ”»å‡»é€Ÿåº¦**å¤ªå¿«è¶…å‡ºé¢„æœŸ
   - å¯èƒ½éœ€è¦è°ƒæ•´å€æ•°ï¼ˆä»1.5æ”¹ä¸º1.3ï¼Ÿï¼‰
   
3. **æŠ€èƒ½æ•ˆæœç¡®å®æ²¡æœ‰æ¢å¤**
   - éœ€è¦æ·»åŠ è°ƒè¯•è¾“å‡ºç¡®è®¤

### å»ºè®®ç”¨æˆ·æµ‹è¯•ï¼š

1. **æµ‹è¯•ç§»åŠ¨é€Ÿåº¦**ï¼š
   - æ¿€æ´»ç‹‚æš´æŠ€èƒ½å‰ï¼Œè®°ä¸‹ç§»åŠ¨åˆ°æŸä¸ªä½ç½®çš„æ—¶é—´
   - æ¿€æ´»ç‹‚æš´æŠ€èƒ½åï¼Œç§»åŠ¨åŒæ ·è·ç¦»
   - å¦‚æœæ—¶é—´ç›¸åŒ â†’ ç§»åŠ¨é€Ÿåº¦æ²¡å˜ï¼ˆæ­£ç¡®ï¼‰
   - å¦‚æœæ—¶é—´å˜çŸ­ â†’ ç§»åŠ¨é€Ÿåº¦å˜å¿«äº†ï¼ˆBUGï¼‰

2. **æµ‹è¯•æ”»å‡»é€Ÿåº¦**ï¼š
   - è®¡æ•°5ç§’å†…çš„æ”»å‡»æ¬¡æ•°
   - æ— æŠ€èƒ½ï¼šçº¦10æ¬¡ï¼ˆ0.5ç§’é—´éš”ï¼‰
   - æœ‰ç‹‚æš´ï¼šçº¦15æ¬¡ï¼ˆ0.33ç§’é—´éš”ï¼‰
   - å¦‚æœæ¥è¿‘15æ¬¡ â†’ æ­£ç¡® âœ…
   - å¦‚æœè¿œè¶…15æ¬¡ â†’ è®¡ç®—æœ‰è¯¯ âŒ

3. **æµ‹è¯•æ¢å¤**ï¼š
   - æ¿€æ´»æŠ€èƒ½ï¼Œç­‰å¾…5ç§’
   - è§‚å¯Ÿæ”»å‡»é€Ÿåº¦æ˜¯å¦æ¢å¤æ­£å¸¸
   - å¦‚æœæ¢å¤ â†’ æ­£ç¡® âœ…
   - å¦‚æœä¸æ¢å¤ â†’ æ¸…ç†æœ‰é—®é¢˜ âŒ

---

*åˆ›å»ºæ—¥æœŸï¼š2024å¹´11æœˆ18æ—¥*

