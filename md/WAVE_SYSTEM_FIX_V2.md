# æ³¢æ¬¡ç³»ç»Ÿä¿®å¤è¯´æ˜ (v2.1 - æœ€ç»ˆç‰ˆ)

## æ ¸å¿ƒä¿®å¤

### ğŸ¯ å…³é”®é—®é¢˜å®šä½

**é—®é¢˜**: å•†åº—å¼¹å‡ºæ—¶åœºä¸Šè¿˜æœ‰å­˜æ´»çš„æ€ªç‰©

**æ ¹æœ¬åŸå› **: 
- ä¹‹å‰çš„é€»è¾‘è¦æ±‚"å‡»æ€æ•°è¾¾æ ‡ AND å…¨éƒ¨ç”Ÿæˆ AND åœºä¸Šæ— æ•Œäºº"ä¸‰ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³
- ä½†ç”±äºæ•Œäººç”Ÿæˆæ˜¯å¼‚æ­¥çš„ï¼ˆæ¯0.5ç§’ç”Ÿæˆä¸€ä¸ªï¼‰ï¼Œå‡»æ€é€Ÿåº¦å¯èƒ½æ¯”ç”Ÿæˆé€Ÿåº¦å¿«
- å¯¼è‡´å‡»æ€æ•°è¾¾æ ‡æ—¶ï¼Œè¿˜æœ‰æ•Œäººæ­£åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­æˆ–å·²ç»ç”Ÿæˆä½†è¿˜æ²¡è¢«å‡»æ€

### âœ… æ­£ç¡®çš„æ³¢æ¬¡ç»“æŸé€»è¾‘

æ³¢æ¬¡åº”è¯¥åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ç»“æŸï¼š
1. âœ… **å‡»æ€æ•°è¾¾åˆ°ç›®æ ‡** (enemies_killed >= enemies_total)
2. âœ… **åœºä¸Šæ²¡æœ‰å­˜æ´»çš„æ•Œäºº** (enemies_alive <= 0)

**ä¸éœ€è¦æ£€æŸ¥**"æ˜¯å¦å…¨éƒ¨ç”Ÿæˆ"ï¼Œå› ä¸ºï¼š
- ç”Ÿæˆå¤±è´¥çš„æ•Œäººä¸åº”è¯¥é˜»æ­¢æ³¢æ¬¡ç»“æŸ
- å…³é”®æ˜¯åœºä¸Šè¦æ²¡æœ‰æ´»ç€çš„æ•Œäºº

## ä¿®æ”¹è¯¦æƒ…

### ä¿®æ”¹1: ç®€åŒ– `on_enemy_spawned()`
```gdscript
func on_enemy_spawned() -> void:
    enemies_spawned_this_wave += 1
    enemies_alive_this_wave += 1
    print("æ•Œäººç”Ÿæˆ: ", enemies_spawned_this_wave, "/", enemies_total_this_wave, " (å­˜æ´»:", enemies_alive_this_wave, ")")
    # ä¸åœ¨è¿™é‡Œæ£€æŸ¥æ³¢æ¬¡ç»“æŸï¼
```

### ä¿®æ”¹2: æ”¹è¿› `on_enemy_killed()`
```gdscript
func on_enemy_killed() -> void:
    enemies_killed_this_wave += 1
    enemies_alive_this_wave -= 1
    
    # åªæ£€æŸ¥ä¸¤ä¸ªæ¡ä»¶ï¼š
    # 1. å‡»æ€æ•°è¾¾æ ‡
    # 2. åœºä¸Šæ— æ•Œäºº
    if enemies_killed >= enemies_total and enemies_alive <= 0:
        _end_current_wave()  # ç«‹å³ç»“æŸæ³¢æ¬¡ï¼
```

## æ³¢æ¬¡æµç¨‹ç¤ºä¾‹

### æ­£å¸¸æµç¨‹
```
ç¬¬1æ³¢å¼€å§‹ (ç›®æ ‡:10ä¸ªæ•Œäºº)
-----------------
ç”Ÿæˆæ•Œäºº1 -> å­˜æ´»:1
ç”Ÿæˆæ•Œäºº2 -> å­˜æ´»:2
å‡»æ€æ•Œäºº1 -> å‡»æ€:1, å­˜æ´»:1
ç”Ÿæˆæ•Œäºº3 -> å­˜æ´»:2
å‡»æ€æ•Œäºº2 -> å‡»æ€:2, å­˜æ´»:1
... (ç»§ç»­ç”Ÿæˆå’Œå‡»æ€)
å‡»æ€æ•Œäºº9 -> å‡»æ€:9, å­˜æ´»:1
ç”Ÿæˆæ•Œäºº10 -> å­˜æ´»:2
å‡»æ€æ•Œäºº10 -> å‡»æ€:10, å­˜æ´»:1 (å‡»æ€æ•°è¾¾æ ‡ä½†è¿˜æœ‰æ•Œäººå­˜æ´»)
... (ç»§ç»­æˆ˜æ–—)
å‡»æ€æœ€åæ•Œäºº -> å‡»æ€:11, å­˜æ´»:0 âœ… æ³¢æ¬¡ç»“æŸï¼å¼¹å‡ºå•†åº—
```

### å¿«é€Ÿå‡»æ€æµç¨‹
```
ç¬¬1æ³¢å¼€å§‹ (ç›®æ ‡:10ä¸ªæ•Œäºº)
-----------------
ç”Ÿæˆæ•Œäºº1 -> å­˜æ´»:1
ç”Ÿæˆæ•Œäºº2 -> å­˜æ´»:2
ç”Ÿæˆæ•Œäºº3 -> å­˜æ´»:3
å‡»æ€æ‰€æœ‰3ä¸ª -> å‡»æ€:3, å­˜æ´»:0 (è¿˜æ²¡è¾¾åˆ°ç›®æ ‡ï¼Œç»§ç»­ç”Ÿæˆ)
ç”Ÿæˆæ•Œäºº4 -> å­˜æ´»:1
... (ç»§ç»­)
å‡»æ€æ•Œäºº10 -> å‡»æ€:10, å­˜æ´»:0 âœ… æ³¢æ¬¡ç»“æŸï¼å¼¹å‡ºå•†åº—
```

## å…³é”®ä¿è¯

### âœ… ä¿è¯1: å•†åº—å¼¹å‡ºæ—¶åœºä¸Šæ— æ•Œäºº
åªæœ‰å½“ `enemies_alive <= 0` æ—¶æ‰ä¼šè°ƒç”¨ `_end_current_wave()`ï¼Œå› æ­¤å•†åº—å¼¹å‡ºæ—¶ä¸€å®šæ²¡æœ‰æ•Œäººã€‚

### âœ… ä¿è¯2: æ³¢æ¬¡ç”Ÿæˆå®Œæ•´æ€§
æ¯æ³¢å¼€å§‹æ—¶ï¼š
1. å‘å‡º `wave_started` ä¿¡å·
2. `now_enemies.gd` å¼€å§‹å¼‚æ­¥ç”Ÿæˆæ•Œäºº
3. ç”Ÿæˆè¿‡ç¨‹ä¸­å¯ä»¥å‡»æ€æ•Œäºº
4. åªè¦å‡»æ€æ•°è¾¾æ ‡ä¸”åœºä¸Šæ— æ•Œäººï¼Œç«‹å³ç»“æŸæ³¢æ¬¡

### âœ… ä¿è¯3: ä¸ä¼šæå‰å¼€å§‹ä¸‹ä¸€æ³¢
`_end_current_wave()` ä¼šï¼š
1. è®¾ç½® `is_wave_in_progress = false`
2. å¼¹å‡ºå•†åº—å¹¶ç­‰å¾…å…³é—­
3. åªæœ‰å•†åº—å…³é—­åæ‰è°ƒç”¨ `start_next_wave()`

## æµ‹è¯•æ£€æŸ¥ç‚¹

### âœ… æµ‹è¯•1: æ­£å¸¸å‡»æ€
1. å¼€å§‹ç¬¬1æ³¢
2. é€ä¸ªå‡»æ€æ•Œäºº
3. å‡»æ€æœ€åä¸€ä¸ªæ•Œäººæ—¶ï¼Œå•†åº—åº”è¯¥ç«‹å³å¼¹å‡º
4. æ­¤æ—¶åœºä¸Šåº”è¯¥æ²¡æœ‰ä»»ä½•æ•Œäºº

### âœ… æµ‹è¯•2: å¿«é€Ÿå‡»æ€
1. å¼€å§‹ç¬¬1æ³¢
2. å¿«é€Ÿå‡»æ€å‰å‡ ä¸ªæ•Œäººï¼ˆå¯èƒ½åé¢è¿˜åœ¨ç”Ÿæˆï¼‰
3. ç»§ç»­æˆ˜æ–—ç›´åˆ°å‡»æ€æ•°è¾¾æ ‡
4. å‡»æ€æœ€åä¸€ä¸ªæ•Œäººæ—¶ï¼Œå•†åº—å¼¹å‡º

### âœ… æµ‹è¯•3: GhostååŠ©
1. åˆ›å»ºå‡ ä¸ªGhost
2. è®©GhostååŠ©å‡»æ€æ•Œäºº
3. Ghostå‡»æ€ä¹Ÿè®¡å…¥å‡»æ€æ•°
4. å‡»æ€æ•°è¾¾æ ‡ä¸”åœºä¸Šæ— æ•Œäººæ—¶ï¼Œæ­£å¸¸ç»“æŸæ³¢æ¬¡

### âœ… æµ‹è¯•4: è®¡æ•°å‡†ç¡®æ€§
è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼š
```
æ•Œäººå‡»æ€: 9/10 (å·²ç”Ÿæˆ:10 å­˜æ´»:1)  <- è¿˜æœ‰1ä¸ªæ•Œäºº
æ•Œäººå‡»æ€: 10/10 (å·²ç”Ÿæˆ:10 å­˜æ´»:0) <- å‡»æ€æœ€åä¸€ä¸ª
æ³¢æ¬¡ç»“æŸæ¡ä»¶æ»¡è¶³ï¼(å‡»æ€æ•°è¾¾æ ‡ä¸”åœºä¸Šæ— å­˜æ´»æ•Œäºº)
=== ç¬¬ 1 æ³¢ç»“æŸ ===
```

## ä¸v2.0çš„åŒºåˆ«

| é¡¹ç›® | v2.0 | v2.1 (å½“å‰ç‰ˆæœ¬) |
|------|------|----------------|
| æ³¢æ¬¡ç»“æŸæ¡ä»¶ | 3ä¸ªæ¡ä»¶ | 2ä¸ªæ¡ä»¶ |
| æ£€æŸ¥ä½ç½® | 2ä¸ªå‡½æ•°éƒ½æ£€æŸ¥ | åªåœ¨killedä¸­æ£€æŸ¥ |
| ç”Ÿæˆå®Œæ•´æ€§ | å¿…é¡»å…¨éƒ¨ç”Ÿæˆ | ä¸å¼ºåˆ¶è¦æ±‚ |
| å“åº”é€Ÿåº¦ | å¯èƒ½å»¶è¿Ÿ | ç«‹å³å“åº” |
| è¾¹ç¼˜æƒ…å†µå¤„ç† | å¯èƒ½å¡ä½ | æœ‰è­¦å‘Šæç¤º |

## ä¿®æ”¹çš„æ–‡ä»¶

1. **Scripts/enemies/wave_manager.gd**
   - ç®€åŒ– `on_enemy_spawned()` - ç§»é™¤æ³¢æ¬¡ç»“æŸæ£€æŸ¥
   - æ”¹è¿› `on_enemy_killed()` - åªæ£€æŸ¥2ä¸ªæ¡ä»¶
   - æ·»åŠ è¾¹ç¼˜æƒ…å†µå¤„ç†ï¼ˆç”Ÿæˆå¤±è´¥è­¦å‘Šï¼‰

## æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹

```
=== å¼€å§‹ç¬¬ 1 æ³¢ ===
ç›®æ ‡å‡»æ€æ•°: 10
å½“å‰å‡»æ€: 0, å·²ç”Ÿæˆ: 0, å­˜æ´»: 0
æˆåŠŸç”Ÿæˆæ•Œäºº: basic ä½ç½®: (956, 734)
æ•Œäººç”Ÿæˆ: 1/10 (å­˜æ´»:1)
æˆåŠŸç”Ÿæˆæ•Œäºº: basic ä½ç½®: (1245, 456)
æ•Œäººç”Ÿæˆ: 2/10 (å­˜æ´»:2)
æ•Œäººå‡»æ€: 1/10 (å·²ç”Ÿæˆ:2 å­˜æ´»:1)
æˆåŠŸç”Ÿæˆæ•Œäºº: fast ä½ç½®: (789, 612)
æ•Œäººç”Ÿæˆ: 3/10 (å­˜æ´»:2)
...
æ•Œäººå‡»æ€: 9/10 (å·²ç”Ÿæˆ:10 å­˜æ´»:1)
æ•Œäººå‡»æ€: 10/10 (å·²ç”Ÿæˆ:10 å­˜æ´»:0)
æ³¢æ¬¡ç»“æŸæ¡ä»¶æ»¡è¶³ï¼(å‡»æ€æ•°è¾¾æ ‡ä¸”åœºä¸Šæ— å­˜æ´»æ•Œäºº)
=== ç¬¬ 1 æ³¢ç»“æŸ ===
å‡»æ€: 10/10
å·²ç”Ÿæˆ: 10 å­˜æ´»: 0
```

## é¢„æœŸæ•ˆæœ

âœ… **å•†åº—å¼¹å‡ºæ—¶æœºå‡†ç¡®**: å¿…å®šæ˜¯åœºä¸Šæœ€åä¸€ä¸ªæ•Œäººè¢«å‡»æ€æ—¶  
âœ… **æ²¡æœ‰æ®‹ç•™æ•Œäºº**: å•†åº—å¼¹å‡ºæ—¶åœºä¸Šä¸€å®šæ²¡æœ‰æ•Œäºº  
âœ… **æ³¢æ¬¡ç”Ÿæˆä¸é‡å¤**: æ¯æ³¢åªç”Ÿæˆä¸€æ¬¡  
âœ… **è®¡æ•°å‡†ç¡®**: å‡»æ€æ•°/æ€»æ•°å§‹ç»ˆæ­£ç¡®  
âœ… **å“åº”é€Ÿåº¦å¿«**: å‡»æ€æœ€åæ•Œäººç«‹å³å¼¹å‡ºå•†åº—  

ç°åœ¨æ³¢æ¬¡ç³»ç»Ÿåº”è¯¥å®Œå…¨ç¬¦åˆé¢„æœŸäº†ï¼ğŸ‰

